<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chovus Smart Bot</title>
</head>
<body>
    <h1>Chovus Smart Bot</h1>
    <div>
        <h2>Balance</h2>
        <p>Wallet Balance: <span id="wallet-balance">Loading...</span> USDT</p>
        <p>Total Balance: <span id="total-balance">Loading...</span> USDT</p>
        <p>Score: <span id="score">Loading...</span></p>
    </div>
    <div>
        <h2>Market Data</h2>
        <pre id="market-data">Loading...</pre> <!-- Promenjeno u <pre> za bolji prikaz JSON-a -->
    </div>
    <div>
        <h2>Strategy</h2>
        <select id="strategy-select">
            <!-- Uklonjen <i> tag i popravljena struktura -->
            <option value="RSI" class="strategy-option">RSI</option>
            <option value="SMA" class="strategy-option">SMA</option>
            <option value="DCA" class="strategy-option">DCA</option>
            <option value="Default" class="strategy-option">Default</option>
        </select>
    </div>
    <div>
        <h2>Logs</h2>
        <pre id="logs">Loading...</pre>
    </div>

    <script>
        async function fetchBalanceAndStrategy() {
            try {
                const response = await fetch('http://localhost:8000/api/balance');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                const walletBalanceElement = document.getElementById('wallet-balance');
                const totalBalanceElement = document.getElementById('total-balance');
                const scoreElement = document.getElementById('score');

                if (!walletBalanceElement || !totalBalanceElement || !scoreElement) {
                    throw new Error('Balance elements not found in DOM');
                }

                walletBalanceElement.textContent = data.wallet_balance || '0.0';
                totalBalanceElement.textContent = data.total_balance || '0.0';
                scoreElement.textContent = data.score || '0';

                // Umesto get_config, koristimo API poziv
                const strategyResponse = await fetch('http://localhost:8000/api/config?key=strategy');
                const strategyData = await strategyResponse.json();
                const strategy = strategyData.value || 'Default';
                const strategySelect = document.getElementById('strategy-select');
                if (strategySelect) {
                    strategySelect.value = strategy;
                }
            } catch (error) {
                console.error('Error fetching balance or strategy:', error);
            }
        }

        async function fetchMarketData() {
            try {
                const response = await fetch('http://localhost:8000/api/market_data');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                const marketDataElement = document.getElementById('market-data');
                if (!marketDataElement) {
                    throw new Error('Market data element not found in DOM');
                }

                marketDataElement.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Error fetching market data:', error);
            }
        }

        async function fetchLogs() {
            try {
                // Popravljamo URL na /logs umesto /api/logs
                const response = await fetch('http://localhost:8000/logs');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                const logsElement = document.getElementById('logs');
                if (!logsElement) {
                    throw new Error('Logs element not found in DOM');
                }

                logsElement.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Error fetching logs:', error);
            }
        }

        async function updateUIFromRest() {
            await fetchBalanceAndStrategy();
            await fetchMarketData();
            await fetchLogs();
        }

        // Inicijalno učitavanje
        updateUIFromRest();

        // Periodično ažuriranje
        setInterval(fetchBalanceAndStrategy, 5000);
        setInterval(fetchMarketData, 5000);
        setInterval(updateUIFromRest, 10000);
    </script>
</body>
</html>